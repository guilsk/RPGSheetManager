<div class="campaign-view">
	<div class="campaign-view__header">
		<div class="campaign-view__header-content">
			<div class="campaign-view__title-section">
				<h1 class="campaign-view__title">{{ campaign?.title }}</h1>
				<span class="campaign-view__badge" [class]="campaign?.activeSession ? 'campaign-view__badge--active' : 'campaign-view__badge--inactive'">
					{{ campaign?.activeSession ? 'Em Sessão' : 'Pausada' }}
				</span>
			</div>
			<div class="campaign-view__header-actions" *ngIf="!editMode">
				<button class="campaign-view__btn campaign-view__btn--secondary" *ngIf="isOwner" (click)="toggleEditMode()">
					Editar
				</button>
				<button class="campaign-view__btn campaign-view__btn--primary" *ngIf="!campaign?.activeSession && isOwner" (click)="startSession()">
					Iniciar Aventura
				</button>
				<button class="campaign-view__btn campaign-view__btn--warning" *ngIf="campaign?.activeSession && isOwner" (click)="endSession()">
					Encerrar Aventura
				</button>
			</div>
			<div class="campaign-view__header-actions" *ngIf="editMode">
				<button class="campaign-view__btn campaign-view__btn--secondary" (click)="cancelEdit()">Cancelar</button>
				<button class="campaign-view__btn campaign-view__btn--primary" (click)="saveChanges()" [disabled]="isLoading">
					{{ isLoading ? 'Salvando...' : 'Salvar' }}
				</button>
			</div>
		</div>
	</div>

	<div class="campaign-view__content" *ngIf="campaign">
		<!-- Modo Visualização -->
		<div class="campaign-view__view-mode" *ngIf="!editMode">
			<div class="campaign-view__campaign-details">
				<div class="campaign-view__detail-card">
					<h3 class="campaign-view__detail-card-title">Informações da Campanha</h3>
					<div class="campaign-view__info-grid">
						<div class="campaign-view__info-item">
							<span class="campaign-view__info-label">Sistema:</span>
							<span class="campaign-view__info-value">{{ getSystemName(campaign.systemId) }}</span>
						</div>
						<div class="campaign-view__info-item">
							<span class="campaign-view__info-label">Mestre:</span>
							<span class="campaign-view__info-value">{{ getMasterName(campaign.masterId) }}</span>
						</div>
						<div class="campaign-view__info-item">
							<span class="campaign-view__info-label">Jogadores:</span>
							<span class="campaign-view__info-value">{{ campaign.playerIds.length || 0 }} participantes</span>
						</div>
						<div class="campaign-view__info-item">
							<span class="campaign-view__info-label">Status:</span>
							<span class="campaign-view__info-value">{{ campaign.activeSession ? 'Aventura em andamento' : 'Aguardando próxima sessão' }}</span>
						</div>
					</div>
				</div>

				<div class="campaign-view__detail-card" *ngIf="campaign.description">
					<h3 class="campaign-view__detail-card-title">História da Campanha</h3>
					<p class="campaign-view__description">{{ campaign.description }}</p>
				</div>

				<div class="campaign-view__detail-card" *ngIf="campaign.characters?.length">
					<h3 class="campaign-view__detail-card-title">Personagens da Aventura</h3>
					<div class="campaign-view__characters-list">
						<div class="campaign-view__character-item" *ngFor="let character of campaign.characters">
							<!-- TODO: Mostrar informações dos personagens -->
							<p>Personagem ID: {{ character.characterId }}</p>
						</div>
					</div>
				</div>

				<div class="campaign-view__danger-zone" *ngIf="isOwner">
					<h3 class="campaign-view__danger-zone-title">Zona de Perigo</h3>
					<button class="campaign-view__btn campaign-view__btn--danger" (click)="deleteCampaign()">
						Encerrar Campanha Permanentemente
					</button>
				</div>
			</div>
		</div>

		<!-- Modo Edição -->
		<div class="campaign-view__edit-mode" *ngIf="editMode">
			<form [formGroup]="editForm" (ngSubmit)="saveChanges()">
				<div class="campaign-view__form-group">
					<label for="title" class="campaign-view__form-label">Nome da Campanha*</label>
					<input id="title" type="text" formControlName="title" class="campaign-view__form-control"
						[class.campaign-view__form-control--error]="editForm.get('title')?.invalid && editForm.get('title')?.touched">
					<div class="campaign-view__error-message" *ngIf="editForm.get('title')?.invalid && editForm.get('title')?.touched">
						Nome é obrigatório
					</div>
				</div>

				<div class="campaign-view__form-group">
					<label for="systemId" class="campaign-view__form-label">Sistema de RPG*</label>
					<select id="systemId" formControlName="systemId" class="campaign-view__form-control"
						[class.campaign-view__form-control--error]="editForm.get('systemId')?.invalid && editForm.get('systemId')?.touched">
						<option value="">Selecione um sistema</option>
						<option *ngFor="let system of systems" [value]="system.id">
							{{ system.name }}
						</option>
					</select>
					<div class="campaign-view__error-message"
						*ngIf="editForm.get('systemId')?.invalid && editForm.get('systemId')?.touched">
						Sistema é obrigatório
					</div>
				</div>

				<div class="campaign-view__form-group">
					<label for="description" class="campaign-view__form-label">História da Campanha</label>
					<textarea id="description" formControlName="description" class="campaign-view__form-control campaign-view__form-control--textarea" rows="6"
						placeholder="Descreva a história, ambientação e objetivos da campanha...">
					</textarea>
				</div>
			</form>
		</div>
	</div>

	<div class="campaign-view__loading-state" *ngIf="!campaign && !isLoading">
		<p>Campanha não encontrada</p>
		<button class="campaign-view__btn campaign-view__btn--primary" routerLink="/campaigns">Voltar às Campanhas</button>
	</div>
</div>
