<div class="character-edit">
	<div class="character-edit__header">
		<h1 class="character-edit__title">{{ isEditMode ? 'Editar Personagem' : 'Criar Novo Personagem' }}</h1>
		<p class="character-edit__description">{{ isEditMode ? 'Modifique os dados do seu personagem' : 'Preencha os dados do seu novo personagem' }}</p>
	</div>

	<form [formGroup]="characterForm" (ngSubmit)="onSubmit()" class="character-edit__form">
		<!-- Informações Básicas -->
		<div class="character-edit__section">
			<h2 class="character-edit__section-title">Informações Básicas</h2>

			<div class="character-edit__row">
				<div class="character-edit__field">
					<label for="name" class="character-edit__label">Nome do Personagem *</label>
					<input type="text" id="name" formControlName="name" class="character-edit__input"
						placeholder="Digite o nome do personagem">
					<div class="character-edit__error"
						*ngIf="characterForm.get('name')?.invalid && characterForm.get('name')?.touched">
						Nome é obrigatório
					</div>
				</div>

				<div class="character-edit__field">
					<label for="system" class="character-edit__label">Sistema de RPG *</label>
					<select id="system" formControlName="systemId" (change)="onSystemSelectionChange($event)"
						class="character-edit__select">
						<option value="" disabled hidden>
							{{ loadingSystems ? 'Carregando sistemas...' : 'Selecione um sistema de RPG' }}
						</option>
						<option *ngFor="let system of systems" [value]="system.id">
							{{ system.name }}
						</option>
					</select>
					<div class="character-edit__error"
						*ngIf="characterForm.get('systemId')?.invalid && characterForm.get('systemId')?.touched">
						Sistema é obrigatório
					</div>
					<div class="character-edit__help" *ngIf="systems.length === 0 && !loadingSystems">
						<small class="character-edit__help-text">Nenhum sistema encontrado. Você pode ser o primeiro a cadastrar um sistema na aba
							'Sistemas'</small>
					</div>
				</div>
			</div>
		</div>

		<!-- Dados do Personagem -->
		<div class="character-edit__data" *ngIf="categories.length > 0 || loadingTemplate">

			<!-- Loading Template -->
			<div class="character-edit__loading" *ngIf="loadingTemplate">
				<p class="character-edit__loading-text">Carregando template do sistema...</p>
			</div>

			<!-- Categorias de dados -->
			<div class="character-edit__category" *ngFor="let category of categories"
				[style.display]="loadingTemplate ? 'none' : 'block'">
				<h3 class="character-edit__category-title">{{ category }}</h3>

				<div class="character-edit__fields">
					<div class="character-edit__field-wrapper" *ngFor="let field of categorizedData[category]"
						[class.character-edit__field-wrapper--hidden]="!field.visible">

						<app-dynamic-field [field]="field" [disabled]="!field.editable"
							[allFieldValues]="getAllFieldValues()"
							(valueChange)="onFieldValueChange(field.name!, $event)">
						</app-dynamic-field>
					</div>
				</div>
			</div>
		</div>

		<!-- Ações -->
		<div class="character-edit__actions">
			<button type="button" class="character-edit__button character-edit__button--secondary" (click)="onCancel()">
				Cancelar
			</button>
			<button type="submit" class="character-edit__button character-edit__button--primary" [disabled]="isSubmitDisabled">
				{{ isEditMode ? 'Salvar Alterações' : 'Criar Personagem' }}
			</button>
		</div>
	</form>
</div>
