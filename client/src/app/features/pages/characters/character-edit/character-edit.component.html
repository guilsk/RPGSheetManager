<div class="character-edit-container">
	<div class="page-header">
		<h1>{{ isEditMode ? 'Editar Personagem' : 'Criar Novo Personagem' }}</h1>
		<p>{{ isEditMode ? 'Modifique os dados do seu personagem' : 'Preencha os dados do seu novo personagem' }}</p>
	</div>

	<form [formGroup]="characterForm" (ngSubmit)="onSubmit()" class="character-form">
		<!-- Informações Básicas -->
		<div class="form-section">
			<h2>Informações Básicas</h2>

			<div class="form-row">
				<div class="form-group">
					<label for="name">Nome do Personagem *</label>
					<input type="text" id="name" formControlName="name" class="form-control"
						placeholder="Digite o nome do personagem">
					<div class="form-error"
						*ngIf="characterForm.get('name')?.invalid && characterForm.get('name')?.touched">
						Nome é obrigatório
					</div>
				</div>

				<div class="form-group">
					<label for="system">Sistema de RPG *</label>
					<select id="system" formControlName="systemId" (change)="onSystemSelectionChange($event)"
						class="form-control">
						<option value="">
							{{ loadingSystems ? 'Carregando sistemas...' : 'Selecione um sistema' }}
						</option>
						<option *ngFor="let system of systems" [value]="system.id">
							{{ system.name }}
						</option>
					</select>
					<div class="form-error"
						*ngIf="characterForm.get('systemId')?.invalid && characterForm.get('systemId')?.touched">
						Sistema é obrigatório
					</div>
					<div class="form-help" *ngIf="systems.length === 0 && !loadingSystems">
						<small>Nenhum sistema encontrado. Você pode ser o primeiro a cadastrar um sistema na aba
							'Sistemas'</small>
					</div>
				</div>
			</div>
		</div>

		<!-- Dados do Personagem -->
		<div class="character-data" *ngIf="categories.length > 0 || loadingTemplate">

			<!-- Loading Template -->
			<div class="loading-template" *ngIf="loadingTemplate">
				<p>Carregando template do sistema...</p>
			</div>

			<!-- Categorias de dados -->
			<div class="category-section" *ngFor="let category of categories"
				[style.display]="loadingTemplate ? 'none' : 'block'">
				<h3>{{ category }}</h3>

				<div class="fields-grid">
					<div class="field-container" *ngFor="let field of categorizedData[category]"
						[class.field-hidden]="!field.visible">

						<app-dynamic-field [field]="field" [disabled]="!field.editable"
							(valueChange)="onFieldValueChange(field.name!, $event)">
						</app-dynamic-field>
					</div>
				</div>
			</div>
		</div>

		<!-- Ações -->
		<div class="form-actions">
			<button type="button" class="btn btn-secondary" (click)="onCancel()">
				Cancelar
			</button>
			<button type="submit" class="btn btn-primary" [disabled]="isSubmitDisabled">
				{{ isEditMode ? 'Salvar Alterações' : 'Criar Personagem' }}
			</button>
		</div>
	</form>
</div>
