<div class="systems-page">
	<div class="systems-page__header">
		<h1 class="systems-page__title">Sistemas de RPG</h1>
		<p class="systems-page__description">Explore sistemas de RPG da comunidade, salve seus favoritos e crie novos sistemas para compartilhar.</p>
	</div>

	<div class="systems-page__content">
		<!-- Upload Area -->
		<div class="systems-page__upload">
			<div class="upload-area" [class.upload-area--uploading]="isUploading" [class.upload-area--drag-over]="isDragOver"
				(dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)">

				<div class="upload-area__content" *ngIf="!isUploading">
					<div class="upload-area__icon">üìÅ</div>
					<h3 class="upload-area__title">Criar Novo Sistema</h3>
					<p class="upload-area__description">Arraste e solte um arquivo JSON aqui ou clique para selecionar</p>
					<input type="file" accept=".json" (change)="onFileSelected($event)" #fileInput
						style="display: none;">
					<button class="upload-area__button" (click)="fileInput.click()">
						Selecionar Arquivo JSON
					</button>
				</div>

				<div class="upload-area__content" *ngIf="isUploading">
					<div class="upload-area__spinner">‚è≥</div>
					<h3 class="upload-area__title">Processando Sistema...</h3>
					<p class="upload-area__description">Aguarde enquanto validamos e salvamos o sistema.</p>
				</div>
			</div>

			<div class="upload-area__error" *ngIf="uploadError">
				<strong>Erro:</strong> {{ uploadError }}
			</div>
		</div>

		<div class="systems-page__search">
			<app-search-bar
				[items]="systems"
				[config]="searchConfig"
				(searchResultsEmit)="onSearchResults($event)">
			</app-search-bar>
		</div>

		<!-- Systems Grid -->
		<div class="systems-page__grid" *ngIf="filteredSystems.length > 0">
			<div class="system-card" *ngFor="let system of getSortedSystems()"
				[class.system-card--saved]="isSystemSavedOrOwned(system)" [class.system-card--own]="isSystemOwner(system)">

				<div class="system-card__header">
					<h3 class="system-card__title">{{ system.name }}</h3>
					<div class="system-card__meta">
						<span class="system-card__author">por {{ getOwnerDisplayName(system.ownerId || '') }}</span>
						<div class="system-card__badges">
							<span class="system-card__badge system-card__badge--own" *ngIf="isSystemOwner(system)">Meu Sistema</span>
							<span class="system-card__badge system-card__badge--saved"
								*ngIf="!isSystemOwner(system) && isSystemSaved(system)">Salvo</span>
							<span class="system-card__badge system-card__badge--obsolete" *ngIf="isSystemObsolete(system)">Obsoleto</span>
						</div>
					</div>
				</div>

				<p class="system-card__description">{{ system.description }}</p>

				<div class="system-card__actions">
					<button class="system-card__button system-card__button--secondary" [routerLink]="['/systems/view', system.id]">
						Ver Detalhes
					</button>

					<!-- Bot√£o para sistemas pr√≥prios -->
					<button class="system-card__button system-card__button--danger" *ngIf="isSystemOwner(system)" (click)="deleteSystem(system)">
						Excluir
					</button>

					<!-- Bot√£o para sistemas de outros n√£o salvos -->
					<button class="system-card__button system-card__button--primary" *ngIf="!isSystemOwner(system) && !isSystemSaved(system)"
						(click)="saveSystem(system)">
						Salvar
					</button>

					<!-- Bot√£o para sistemas de outros j√° salvos (n√£o obsoletos) -->
					<button class="system-card__button system-card__button--outline"
						*ngIf="!isSystemOwner(system) && isSystemSaved(system) && !isSystemObsolete(system)"
						(click)="unsaveSystem(system)">
						Remover dos Salvos
					</button>

					<!-- Bot√£o para sistemas obsoletos salvos -->
					<button class="system-card__button system-card__button--danger"
						*ngIf="!isSystemOwner(system) && isSystemSaved(system) && isSystemObsolete(system)"
						(click)="deleteObsoleteSystem(system)">
						Excluir Definitivamente
					</button>
				</div>
			</div>
		</div>

		<!-- Empty State -->
		<div class="systems-page__empty" *ngIf="getSortedSystems().length === 0 && !isUploading">
			<div class="systems-page__empty-icon">üé≤</div>
			<h3 class="systems-page__empty-title">Nenhum Sistema Dispon√≠vel</h3>
			<p class="systems-page__empty-description">Seja o primeiro a criar um sistema de RPG! Fa√ßa upload de um arquivo JSON para come√ßar.</p>
		</div>
	</div>
</div>
